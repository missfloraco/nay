import{r as n,u as C,a as _,b as k,c as G,d as I,l as P,j as e,C as H,i as F}from"./index-CytmB-Er.js";import{A as D,E as M,P as W}from"./passwordstrengthindicator-2h-1PVB9.js";import{C as B}from"./constants-DPRNOWFl.js";import{o as y,s as o,l as S}from"./schemas-CsUKkzBv.js";import{C as $}from"./circle-check-BvJnU8bW.js";import{U as q}from"./user-BVnW-pgT.js";import{M as z}from"./mail-iCRNgKv8.js";import{E as K}from"./eye-DlkzJROP.js";import{G as Y}from"./globe-CniT1AxV.js";import{L as J}from"./loader-circle-Bj7yhw_M.js";import{A as Q}from"./arrow-left-Bh77dnOQ.js";const V=y({email:o().email({message:"البريد الإلكتروني غير صالح"}),password:o().min(1,{message:"كلمة المرور مطلوبة"})}),X=y({fullName:o().min(3,{message:"الاسم الكامل يجب أن يكون 3 أحرف على الأقل"}),email:o().email({message:"البريد الإلكتروني غير صالح"}),password:o().min(6,{message:"كلمة المرور يجب أن تكون 6 أحرف على الأقل"}),country:o().min(2,{message:"الرجاء اختيار الدولة"})}),Z=y({email:o().email({message:"البريد الإلكتروني غير صالح"})});y({name:o().min(2,{message:"الاسم مطلوب"}),email:o().email({message:"بريد إلكتروني غير صحيح"}),whatsapp:o().regex(/^\+?[0-9]{7,15}$/,{message:"رقم الهاتف غير صالح"}).optional().or(S("")),country_code:o().optional(),new_password:o().min(6,{message:"كلمة المرور الجديدة قصيرة جداً"}).optional().or(S("")),confirm_password:o().optional().or(S(""))}).refine(l=>!(l.new_password&&l.new_password!==l.confirm_password),{message:"كلمات المرور غير متطابقة",path:["confirm_password"]});function me({initialMode:l="login"}){const[a,E]=n.useState(l),T=C(),c=_(),d=k(),b=G();b.pathname.includes("/login");const[j,u]=n.useState(!1),[g,m]=n.useState(""),[L,A]=n.useState(""),[h,O]=n.useState(!1),{t:r}=I(),[s,x]=n.useState({fullName:"",email:"",password:"",country:"PS"}),[U,f]=n.useState("weak");n.useEffect(()=>{const t=s.password;t.length===0||t.length<6?f("weak"):t.length<10?f("medium"):f("strong")},[s.password]),n.useEffect(()=>{const p=new URLSearchParams(b.search).get("impersonate_token");p&&(u(!0),c.loginWithToken(p).then(()=>{d("/app")}).catch(w=>{P.error("Impersonation failed",w),m("رابط الدخول غير صالح أو منتهي الصلاحية"),u(!1)}))},[b.search,c,d]);const v=async()=>{try{try{await F(),await c.login(s.email,s.password),d("/app");return}catch{await T.login(s.email,s.password),d("/admin");return}}catch(t){throw t}},R=async t=>{var p,w;t.preventDefault(),m(""),A(""),u(!0);try{if(a==="login")V.parse({email:s.email,password:s.password}),await v();else if(a==="register"){X.parse(s);const i=new FormData;i.append("name",s.fullName),i.append("email",s.email),i.append("password",s.password),i.append("country",s.country),i.append("currency","ILS"),await c.register(i),d("/app/dashboard")}else a==="forgot-password"&&(Z.parse({email:s.email}),await c.forgotPassword(s.email),A(r("AUTH.FORGOT_PASSWORD.SUCCESS_MESSAGE")))}catch(i){i.errors?m(i.errors[0].message):m(((w=(p=i.response)==null?void 0:p.data)==null?void 0:w.message)||"البيانات المدخلة غير صحيحة. يرجى التأكد من البريد الإلكتروني وكلمة المرور.")}finally{u(!1)}},N=t=>{E(t),m(""),A("")};return e.jsx(D,{title:r(`AUTH.${a==="forgot-password"?"FORGOT_PASSWORD":a.toUpperCase()}.TITLE`),subtitle:r(`AUTH.${a==="forgot-password"?"FORGOT_PASSWORD":a.toUpperCase()}.SUBTITLE`),children:e.jsxs("form",{onSubmit:R,className:"space-y-8 animate-in fade-in slide-in-from-right-5 duration-500",children:[g&&e.jsxs("div",{role:"alert","aria-live":"assertive",className:"p-5 bg-accent2/10 border-2 border-accent2/20 text-accent2 text-sm font-bold rounded-2xl flex items-center gap-3 animate-in slide-in-from-top-2 duration-300",children:[e.jsx(H,{className:"w-5 h-5 shrink-0"}),e.jsx("span",{children:g})]}),L&&e.jsxs("div",{role:"alert","aria-live":"polite",className:"p-5 bg-accent1/10 border-2 border-accent1/20 text-accent1 text-sm font-bold rounded-2xl flex items-center gap-3 animate-in slide-in-from-top-2 duration-300",children:[e.jsx($,{className:"w-5 h-5 shrink-0"}),e.jsx("span",{children:L})]}),e.jsxs("div",{className:"space-y-6",children:[a==="register"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{htmlFor:"fullName",className:"block text-sm font-black text-gray-700 dark:text-gray-300",children:r("AUTH.REGISTER.FULL_NAME_LABEL")}),e.jsxs("div",{className:"relative group",children:[e.jsx(q,{className:"absolute left-5 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 group-focus-within:text-primary transition-colors","aria-hidden":"true"}),e.jsx("input",{id:"fullName",type:"text",required:!0,value:s.fullName,onChange:t=>x({...s,fullName:t.target.value}),placeholder:r("AUTH.REGISTER.FULL_NAME_PLACEHOLDER"),className:"onboarding-input pl-14","aria-label":r("AUTH.REGISTER.FULL_NAME_LABEL"),"aria-required":"true"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-black text-gray-700 dark:text-gray-300",children:r(`AUTH.${a==="forgot-password"?"FORGOT_PASSWORD":a.toUpperCase()}.EMAIL_LABEL`)}),e.jsxs("div",{className:"relative group",children:[e.jsx(z,{className:"absolute left-5 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 group-focus-within:text-primary transition-colors","aria-hidden":"true"}),e.jsx("input",{id:"email",type:"email",required:!0,value:s.email,onChange:t=>x({...s,email:t.target.value}),placeholder:r(`AUTH.${a==="register"?"REGISTER":"LOGIN"}.EMAIL_PLACEHOLDER`),className:"onboarding-input pl-14","aria-label":r(`AUTH.${a==="forgot-password"?"FORGOT_PASSWORD":a.toUpperCase()}.EMAIL_LABEL`),"aria-required":"true","aria-invalid":g?"true":"false"})]})]}),a!=="forgot-password"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-black text-gray-700 dark:text-gray-300",children:r(`AUTH.${a.toUpperCase()}.PASSWORD_LABEL`)}),a==="login"&&e.jsx("button",{type:"button",onClick:()=>N("forgot-password"),className:"text-xs font-bold text-primary hover:underline transition-colors","aria-label":"نسيت كلمة المرور",children:r("AUTH.LOGIN.FORGOT_PASSWORD")})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("button",{type:"button",onClick:()=>O(!h),className:"absolute left-5 top-1/2 -translate-y-1/2 text-gray-400 hover:text-primary transition-colors z-10","aria-label":h?"إخفاء كلمة المرور":"إظهار كلمة المرور",children:h?e.jsx(M,{className:"w-5 h-5"}):e.jsx(K,{className:"w-5 h-5"})}),e.jsx("input",{id:"password",type:h?"text":"password",required:!0,value:s.password,onChange:t=>x({...s,password:t.target.value}),placeholder:r(`AUTH.${a.toUpperCase()}.PASSWORD_PLACEHOLDER`),className:"onboarding-input pl-14","aria-label":r(`AUTH.${a.toUpperCase()}.PASSWORD_LABEL`),"aria-required":"true","aria-invalid":g?"true":"false"})]}),a==="register"&&e.jsx(W,{strength:U,passwordLength:s.password.length})]}),a==="register"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{htmlFor:"country",className:"block text-sm font-black text-gray-700 dark:text-gray-300",children:r("AUTH.REGISTER.COUNTRY_LABEL")}),e.jsxs("div",{className:"relative group",children:[e.jsx(Y,{className:"absolute left-5 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 group-focus-within:text-primary transition-colors","aria-hidden":"true"}),e.jsx("select",{id:"country",value:s.country,onChange:t=>x({...s,country:t.target.value}),className:"onboarding-input pl-14 appearance-none cursor-pointer","aria-label":r("auth.register.countryLabel"),children:B.map(t=>e.jsx("option",{value:t.code,children:t.name},t.code))})]})]})]}),e.jsx("button",{type:"submit",disabled:j,className:"w-full py-4 bg-primary text-white rounded-2xl font-black text-base shadow-xl shadow-primary/20 hover:scale-[1.02] active:scale-95 transition-all disabled:opacity-50 flex items-center justify-center gap-3 mt-8","aria-label":r(`AUTH.${a==="forgot-password"?"FORGOT_PASSWORD":a.toUpperCase()}.SUBMIT`),children:j?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"جاري المعالجة..."})]}):r(`AUTH.${a==="forgot-password"?"FORGOT_PASSWORD":a.toUpperCase()}.SUBMIT`)}),e.jsx("div",{className:"pt-6 text-center border-t border-gray-200 dark:border-dark-800",children:a==="login"?e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-bold",children:[r("AUTH.LOGIN.NO_ACCOUNT")," ",e.jsx("button",{type:"button",onClick:()=>N("register"),className:"text-primary hover:underline font-black transition-colors",children:r("AUTH.LOGIN.REGISTER_NOW")})]}):e.jsxs("button",{type:"button",onClick:()=>N("login"),className:"text-sm text-gray-500 dark:text-gray-400 font-bold hover:text-primary flex items-center justify-center gap-2 mx-auto transition-colors group",children:[e.jsx(Q,{className:"w-4 h-4 group-hover:-translate-x-1 transition-transform"}),r("AUTH.LOGIN.BACK_TO_LOGIN")]})})]})})}export{me as default};
