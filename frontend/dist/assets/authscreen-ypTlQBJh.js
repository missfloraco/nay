import{r as n,u as C,a as _,b as k,c as I,d as G,l as P,j as e,C as H,i as F,e as D}from"./index-ljXU23zv.js";import{A as M,E as W,P as B}from"./passwordstrengthindicator-DbtELqWY.js";import{C as $}from"./constants-DPRNOWFl.js";import{o as y,s as o,l as S}from"./schemas-CsUKkzBv.js";import{C as q}from"./circle-check-BN4sWwsX.js";import{U as z}from"./user-BhkJww6t.js";import{M as K}from"./mail-_C7isKWQ.js";import{E as Y}from"./eye-BsItnNWp.js";import{G as J}from"./globe-buysNsx7.js";import{L as Q}from"./loader-circle-D5B7Ya48.js";import{A as V}from"./arrow-left-DUFbv6ZI.js";const X=y({email:o().email({message:"البريد الإلكتروني غير صالح"}),password:o().min(1,{message:"كلمة المرور مطلوبة"})}),Z=y({fullName:o().min(3,{message:"الاسم الكامل يجب أن يكون 3 أحرف على الأقل"}),email:o().email({message:"البريد الإلكتروني غير صالح"}),password:o().min(6,{message:"كلمة المرور يجب أن تكون 6 أحرف على الأقل"}),country:o().min(2,{message:"الرجاء اختيار الدولة"})}),ee=y({email:o().email({message:"البريد الإلكتروني غير صالح"})});y({name:o().min(2,{message:"الاسم مطلوب"}),email:o().email({message:"بريد إلكتروني غير صحيح"}),whatsapp:o().regex(/^\+?[0-9]{7,15}$/,{message:"رقم الهاتف غير صالح"}).optional().or(S("")),country_code:o().optional(),new_password:o().min(6,{message:"كلمة المرور الجديدة قصيرة جداً"}).optional().or(S("")),confirm_password:o().optional().or(S(""))}).refine(l=>!(l.new_password&&l.new_password!==l.confirm_password),{message:"كلمات المرور غير متطابقة",path:["confirm_password"]});function pe({initialMode:l="login"}){const[s,E]=n.useState(l),T=C(),c=_(),d=k(),b=I();b.pathname.includes("/login");const[j,u]=n.useState(!1),[g,m]=n.useState(""),[L,A]=n.useState(""),[h,U]=n.useState(!1),{t:r}=G(),[t,x]=n.useState({fullName:"",email:"",password:"",country:"PS"}),[O,f]=n.useState("weak");n.useEffect(()=>{const a=t.password;a.length===0||a.length<6?f("weak"):a.length<10?f("medium"):f("strong")},[t.password]),n.useEffect(()=>{const p=new URLSearchParams(b.search).get("impersonate_token");p&&(u(!0),c.loginWithToken(p).then(()=>{d("/app")}).catch(w=>{P.error("Impersonation failed",w),m("رابط الدخول غير صالح أو منتهي الصلاحية"),u(!1)}))},[b.search,c,d]);const v=async()=>{try{await F();const a=await D.post("/login",{email:t.email,password:t.password});a.type==="admin"?(await T.refreshUser(),d("/admin")):(a.token&&sessionStorage.setItem("tenant_token",a.token),await c.refreshUser(),d("/app"))}catch(a){throw a}},R=async a=>{var p,w;a.preventDefault(),m(""),A(""),u(!0);try{if(s==="login")X.parse({email:t.email,password:t.password}),await v();else if(s==="register"){Z.parse(t);const i=new FormData;i.append("name",t.fullName),i.append("email",t.email),i.append("password",t.password),i.append("country",t.country),i.append("currency","ILS"),await c.register(i),d("/app/dashboard")}else s==="forgot-password"&&(ee.parse({email:t.email}),await c.forgotPassword(t.email),A(r("AUTH.FORGOT_PASSWORD.SUCCESS_MESSAGE")))}catch(i){i.errors?m(i.errors[0].message):m(((w=(p=i.response)==null?void 0:p.data)==null?void 0:w.message)||"البيانات المدخلة غير صحيحة. يرجى التأكد من البريد الإلكتروني وكلمة المرور.")}finally{u(!1)}},N=a=>{E(a),m(""),A("")};return e.jsx(M,{title:r(`AUTH.${s==="forgot-password"?"FORGOT_PASSWORD":s.toUpperCase()}.TITLE`),subtitle:r(`AUTH.${s==="forgot-password"?"FORGOT_PASSWORD":s.toUpperCase()}.SUBTITLE`),children:e.jsxs("form",{onSubmit:R,className:"space-y-8 animate-in fade-in slide-in-from-right-5 duration-500",children:[g&&e.jsxs("div",{role:"alert","aria-live":"assertive",className:"p-5 bg-accent2/10 border-2 border-accent2/20 text-accent2 text-sm font-bold rounded-2xl flex items-center gap-3 animate-in slide-in-from-top-2 duration-300",children:[e.jsx(H,{className:"w-5 h-5 shrink-0"}),e.jsx("span",{children:g})]}),L&&e.jsxs("div",{role:"alert","aria-live":"polite",className:"p-5 bg-accent1/10 border-2 border-accent1/20 text-accent1 text-sm font-bold rounded-2xl flex items-center gap-3 animate-in slide-in-from-top-2 duration-300",children:[e.jsx(q,{className:"w-5 h-5 shrink-0"}),e.jsx("span",{children:L})]}),e.jsxs("div",{className:"space-y-6",children:[s==="register"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{htmlFor:"fullName",className:"block text-sm font-black text-gray-700 dark:text-gray-300",children:r("AUTH.REGISTER.FULL_NAME_LABEL")}),e.jsxs("div",{className:"relative group",children:[e.jsx(z,{className:"absolute left-5 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 group-focus-within:text-primary transition-colors","aria-hidden":"true"}),e.jsx("input",{id:"fullName",type:"text",required:!0,value:t.fullName,onChange:a=>x({...t,fullName:a.target.value}),placeholder:r("AUTH.REGISTER.FULL_NAME_PLACEHOLDER"),className:"onboarding-input pl-14","aria-label":r("AUTH.REGISTER.FULL_NAME_LABEL"),"aria-required":"true"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-black text-gray-700 dark:text-gray-300",children:r(`AUTH.${s==="forgot-password"?"FORGOT_PASSWORD":s.toUpperCase()}.EMAIL_LABEL`)}),e.jsxs("div",{className:"relative group",children:[e.jsx(K,{className:"absolute left-5 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 group-focus-within:text-primary transition-colors","aria-hidden":"true"}),e.jsx("input",{id:"email",type:"email",required:!0,value:t.email,onChange:a=>x({...t,email:a.target.value}),placeholder:r(`AUTH.${s==="register"?"REGISTER":"LOGIN"}.EMAIL_PLACEHOLDER`),className:"onboarding-input pl-14","aria-label":r(`AUTH.${s==="forgot-password"?"FORGOT_PASSWORD":s.toUpperCase()}.EMAIL_LABEL`),"aria-required":"true","aria-invalid":g?"true":"false"})]})]}),s!=="forgot-password"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-black text-gray-700 dark:text-gray-300",children:r(`AUTH.${s.toUpperCase()}.PASSWORD_LABEL`)}),s==="login"&&e.jsx("button",{type:"button",onClick:()=>N("forgot-password"),className:"text-xs font-bold text-primary hover:underline transition-colors","aria-label":"نسيت كلمة المرور",children:r("AUTH.LOGIN.FORGOT_PASSWORD")})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("button",{type:"button",onClick:()=>U(!h),className:"absolute left-5 top-1/2 -translate-y-1/2 text-gray-400 hover:text-primary transition-colors z-10","aria-label":h?"إخفاء كلمة المرور":"إظهار كلمة المرور",children:h?e.jsx(W,{className:"w-5 h-5"}):e.jsx(Y,{className:"w-5 h-5"})}),e.jsx("input",{id:"password",type:h?"text":"password",required:!0,value:t.password,onChange:a=>x({...t,password:a.target.value}),placeholder:r(`AUTH.${s.toUpperCase()}.PASSWORD_PLACEHOLDER`),className:"onboarding-input pl-14","aria-label":r(`AUTH.${s.toUpperCase()}.PASSWORD_LABEL`),"aria-required":"true","aria-invalid":g?"true":"false"})]}),s==="register"&&e.jsx(B,{strength:O,passwordLength:t.password.length})]}),s==="register"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{htmlFor:"country",className:"block text-sm font-black text-gray-700 dark:text-gray-300",children:r("AUTH.REGISTER.COUNTRY_LABEL")}),e.jsxs("div",{className:"relative group",children:[e.jsx(J,{className:"absolute left-5 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 group-focus-within:text-primary transition-colors","aria-hidden":"true"}),e.jsx("select",{id:"country",value:t.country,onChange:a=>x({...t,country:a.target.value}),className:"onboarding-input pl-14 appearance-none cursor-pointer","aria-label":r("auth.register.countryLabel"),children:$.map(a=>e.jsx("option",{value:a.code,children:a.name},a.code))})]})]})]}),e.jsx("button",{type:"submit",disabled:j,className:"w-full py-4 bg-primary text-white rounded-2xl font-black text-base shadow-xl shadow-primary/20 hover:scale-[1.02] active:scale-95 transition-all disabled:opacity-50 flex items-center justify-center gap-3 mt-8","aria-label":r(`AUTH.${s==="forgot-password"?"FORGOT_PASSWORD":s.toUpperCase()}.SUBMIT`),children:j?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"جاري المعالجة..."})]}):r(`AUTH.${s==="forgot-password"?"FORGOT_PASSWORD":s.toUpperCase()}.SUBMIT`)}),e.jsx("div",{className:"pt-6 text-center border-t border-gray-200 dark:border-dark-800",children:s==="login"?e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-bold",children:[r("AUTH.LOGIN.NO_ACCOUNT")," ",e.jsx("button",{type:"button",onClick:()=>N("register"),className:"text-primary hover:underline font-black transition-colors",children:r("AUTH.LOGIN.REGISTER_NOW")})]}):e.jsxs("button",{type:"button",onClick:()=>N("login"),className:"text-sm text-gray-500 dark:text-gray-400 font-bold hover:text-primary flex items-center justify-center gap-2 mx-auto transition-colors group",children:[e.jsx(V,{className:"w-4 h-4 group-hover:-translate-x-1 transition-transform"}),r("AUTH.LOGIN.BACK_TO_LOGIN")]})})]})})}export{pe as default};
