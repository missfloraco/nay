import{g as P,q as $,r as o,j as e,s as A,f as N,l as C,v as F,e as E,w as M}from"./index-CytmB-Er.js";import{A as V}from"./adminlayout-DIdHhvbo.js";import{C as q,I as z,a as H,D as R,A as U,T as B}from"./table-cells-CvzEJ-64.js";import{a as G}from"./helpers-CPSgdYRA.js";import{S as I}from"./sidebar-left-s-soE1BO.js";import{U as J}from"./user-BVnW-pgT.js";import{D as K}from"./dollar-sign-ZmsrkLHH.js";import"./adslot-1WJBBd70.js";import"./users-DikJyHif.js";import"./loader-circle-Bj7yhw_M.js";import"./database-BnUETau0.js";import"./mail-iCRNgKv8.js";import"./log-out-DPAkzXIl.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Q=P("calendar",O),W=({tenants:g,selectedTenantId:i,onSelectTenant:m,onSuccess:x})=>{const{showToast:d}=$(),[c,w]=o.useState(""),[h,y]=o.useState(!1),[_,p]=o.useState(!1),[r,l]=o.useState({amount:"",subscription_end_date:"",payment_method:"cash",notes:""}),s=g.find(t=>t.id===Number(i));o.useEffect(()=>{p(!!i)},[i]);const f=g.filter(t=>t.name.toLowerCase().includes(c.toLowerCase())||t.email.toLowerCase().includes(c.toLowerCase())),S=async t=>{var j,k;if(t.preventDefault(),!i)return;if(!r.subscription_end_date)return d("يرجى اختيار تاريخ انتهاء الاشتراك","error");const b={tenant_id:i,amount:r.amount||null,subscription_end_date:r.subscription_end_date,payment_method:r.payment_method,notes:r.notes};y(!0);try{await N.post("/admin/payments",b),d("تم تسجيل الدفعة بنجاح","success"),x(),l({amount:"",subscription_end_date:"",payment_method:"cash",notes:""})}catch(v){C.error(v),d(((k=(j=v.response)==null?void 0:j.data)==null?void 0:k.message)||"فشل تسجيل الدفعة","error")}finally{y(!1)}};return e.jsxs("div",{className:"flex flex-col h-full space-y-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"text-sm font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:"إدارة العمليات"}),e.jsx("p",{className:"text-xs text-gray-500 font-bold",children:"اختر المشترك لتسجيل دفعة أو تصفية السجل"})]}),_?e.jsxs("div",{className:"flex-1 flex flex-col space-y-5 animate-in slide-in-from-left duration-300",children:[e.jsx("div",{className:"p-4 rounded-2xl bg-primary/5 dark:bg-primary/10 border border-primary/10 relative overflow-hidden group",children:e.jsxs("div",{className:"relative z-10 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary text-white flex items-center justify-center font-black",children:s==null?void 0:s.name.charAt(0)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-xs font-black text-gray-900 dark:text-white",children:s==null?void 0:s.name}),e.jsx("p",{className:"text-[10px] text-gray-500 font-bold",children:s==null?void 0:s.email})]}),e.jsx("button",{onClick:()=>m(""),className:"p-1.5 hover:bg-primary/10 rounded-lg text-primary transition-colors",children:e.jsx(q,{className:"w-4 h-4"})})]})}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest px-1",children:"المبلغ (ILS)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"0",step:"0.01",value:r.amount,onChange:t=>l({...r,amount:t.target.value}),className:"w-full px-3 py-2.5 rounded-xl border border-gray-100 dark:border-dark-700 bg-gray-50/50 dark:bg-dark-800 focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all font-bold text-xs text-left",placeholder:"0.00"}),e.jsx(K,{className:"absolute right-3 top-2.5 w-4 h-4 text-gray-400"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest px-1",children:"انتهاء الاشتراك"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:r.subscription_end_date,onChange:t=>l({...r,subscription_end_date:t.target.value}),className:"w-full px-3 py-2.5 rounded-xl border border-gray-100 dark:border-dark-700 bg-gray-50/50 dark:bg-dark-800 focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all font-bold text-xs",required:!0}),e.jsx(Q,{className:"absolute left-3 top-2.5 w-4 h-4 text-gray-400"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest px-1",children:"طريقة الدفع"}),e.jsxs("select",{value:r.payment_method,onChange:t=>l({...r,payment_method:t.target.value}),className:"w-full px-3 py-2.5 rounded-xl border border-gray-100 dark:border-dark-700 bg-gray-50/50 dark:bg-dark-800 focus:ring-2 focus:ring-primary/20 transition-all font-bold text-xs",children:[e.jsx("option",{value:"cash",children:"نقد"}),e.jsx("option",{value:"bank_transfer",children:"تحويل بنكي"}),e.jsx("option",{value:"check",children:"شيك"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest px-1",children:"ملاحظات"}),e.jsx("textarea",{value:r.notes,onChange:t=>l({...r,notes:t.target.value}),className:"w-full px-3 py-2.5 rounded-xl border border-gray-100 dark:border-dark-700 bg-gray-50/50 dark:bg-dark-800 focus:ring-2 focus:ring-primary/20 transition-all font-medium text-xs h-20 resize-none",placeholder:"..."})]}),e.jsx("button",{type:"submit",disabled:h,className:"w-full py-3 bg-primary hover:bg-primary-dark text-white rounded-xl text-xs font-black transition-all shadow-lg hover:shadow-primary/30 active:scale-95 disabled:opacity-50 flex items-center justify-center gap-2",children:h?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4"}),"حفظ البيانات"]})})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col space-y-4 overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"absolute right-3 top-2.5 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"بحث عن مشترك...",value:c,onChange:t=>w(t.target.value),className:"w-full pr-9 pl-3 py-2 rounded-xl border border-gray-100 dark:border-dark-700 bg-gray-50/50 dark:bg-dark-800 focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all text-xs font-bold"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar space-y-1 pr-1",children:[e.jsxs("button",{onClick:()=>m(""),className:`w-full flex items-center gap-3 p-3 rounded-xl transition-all text-right font-bold text-xs ${i?"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-dark-800":"bg-primary text-white shadow-lg shadow-primary/20"}`,children:[e.jsx(J,{className:`w-4 h-4 ${i?"text-primary":"text-white"}`}),e.jsx("span",{children:"جميع المشتركين"})]}),f.map(t=>e.jsxs("button",{onClick:()=>m(t.id.toString()),className:`w-full flex items-center gap-3 p-3 rounded-xl transition-all text-right group ${i===t.id.toString()?"bg-primary text-white shadow-lg shadow-primary/20":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-dark-800"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center font-black text-[10px] ${i===t.id.toString()?"bg-white/20":"bg-primary/10 text-primary"}`,children:t.name.charAt(0)}),e.jsxs("div",{className:"flex-1 text-right overflow-hidden",children:[e.jsx("div",{className:"text-[11px] font-black truncate",children:t.name}),e.jsx("div",{className:`text-[9px] truncate opacity-60 ${i===t.id.toString()?"text-white":""}`,children:t.email})]})]},t.id))]})]})]})};function de(){var L;const{showSuccess:g,showError:i,showConfirm:m}=F(),[x,d]=E(),[c,w]=o.useState([]),[h,y]=o.useState([]),[_,p]=o.useState(!0),[r,l]=o.useState(null),[s,f]=o.useState(x.get("tenant")||""),S=async()=>{try{const n=(await N.get("/admin/tenants")).data||[];return y(n),n}catch(a){return C.error(a),[]}},t=async()=>{p(!0);try{const a=await N.get("/admin/payments");w(a.data||[])}catch(a){C.error(a),i("فشل تحميل سجل الدفعات")}finally{p(!1)}};o.useEffect(()=>{(async()=>{await S(),await t();const n=x.get("tenant"),u=x.get("highlight");n&&(f(n),u==="true"&&(l(Number(n)),setTimeout(()=>l(null),3e3)))})()},[]);const b=async a=>{if(await m({title:"حذف سجل الدفع",message:"هل أنت متأكد من حذف هذه العملية؟",confirmLabel:"حذف",isDestructive:!0}))try{await N.delete(`/admin/payments/${a}`),g("تم الحذف بنجاح"),t()}catch{i("فشل الحذف")}},j=s?c.filter(a=>{var n;return((n=a.tenant)==null?void 0:n.id)===Number(s)}):c,k=a=>{f(a),d(a?{tenant:a}:{})},v=o.useMemo(()=>[{header:"المستأجر",accessor:a=>{var n,u,D;return e.jsx(z,{name:((n=a.tenant)==null?void 0:n.name)||"---",email:(u=a.tenant)==null?void 0:u.email,highlight:r===((D=a.tenant)==null?void 0:D.id)})},exportValue:a=>{var n;return((n=a.tenant)==null?void 0:n.name)||"---"},className:"min-w-[200px]"},{header:"المبلغ",accessor:a=>e.jsx(H,{amount:a.amount||0,currency:a.currency}),exportValue:a=>`${a.amount||0} ${a.currency}`,className:"min-w-[120px]"},{header:"التاريخ",accessor:a=>e.jsx(R,{date:a.paid_at}),exportValue:a=>G(a.paid_at),width:"15%"},{header:"الطريقة",accessor:a=>e.jsxs("span",{className:"px-3 py-1.5 rounded-xl bg-gray-100 dark:bg-gray-800 text-xs font-black text-gray-600 dark:text-gray-400 border border-gray-200/50 dark:border-white/5",children:[a.payment_method==="cash"&&"نقد",a.payment_method==="bank_transfer"&&"تحويل بنكي",a.payment_method==="check"&&"شيك",a.payment_method==="other"&&a.payment_method]}),exportValue:a=>a.payment_method==="cash"?"نقد":a.payment_method==="bank_transfer"?"تحويل بنكي":a.payment_method==="check"?"شيك":a.payment_method,width:"15%"},{header:"ملاحظات",accessor:a=>e.jsx("span",{className:"text-xs text-gray-400 font-medium truncate block max-w-[200px]",title:a.notes,children:a.notes||"-"}),exportValue:a=>a.notes||"-",width:"20%"},{header:"",accessor:a=>e.jsx(U,{children:e.jsx("button",{onClick:()=>b(a.id),className:"p-2.5 text-red-400 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-xl transition-all active:scale-95",children:e.jsx(M,{className:"w-4 h-4"})})}),width:"50px"}],[r,b]);return e.jsx(V,{title:"إدارة المدفوعات",leftSidebarContent:e.jsx(W,{tenants:h,selectedTenantId:s,onSelectTenant:k,onSuccess:t}),children:e.jsxs("div",{className:"flex flex-col h-full bg-white dark:bg-gray-900",children:[e.jsx("div",{className:"p-6 border-b border-gray-100 dark:border-gray-800",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-black text-gray-900 dark:text-white",children:"سجل الدفعات"}),e.jsx("p",{className:"text-sm text-gray-500 font-bold mt-1",children:s?`عرض المدفوعات الخاصة بـ ${((L=h.find(a=>a.id===Number(s)))==null?void 0:L.name)||"..."}`:"إحصائيات وسجل جميع المساهمات المالية"})]})})}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:e.jsx(B,{columns:v,data:j,isLoading:_,emptyMessage:s?"لا توجد دفعات لهذا المشترك":"لا توجد عمليات دفع مسجلة",exportFileName:"سجل_المدفوعات"})})]})})}export{de as default};
