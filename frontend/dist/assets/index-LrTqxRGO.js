import{f as A,r as x,j as e,Z as L,T as j,t as O,p as D,v as T,M as E}from"./index-CyxQwsQl.js";import{C as k,A as M}from"./adminlayout-BZTWR09H.js";import{T as $}from"./table-Bgq6U4EG.js";import{I as P}from"./input-field-Cci2A17T.js";import{R as _}from"./rotate-ccw-D39Bn6F_.js";import{L as z}from"./layers-BGnbwtPl.js";import{G as J}from"./globe-koAPSkYK.js";import{S as F}from"./save-BnVArzGb.js";import{a as G}from"./helpers-CPSgdYRA.js";import{P as S}from"./adslot-DC0mcUoM.js";import{T as R}from"./terminal-DHh6YHro.js";import{S as K}from"./square-pen-C7dXzopo.js";import"./drawer-Bj6KWlWm.js";import"./sparkles-ClcDe-Ep.js";import"./log-out-DA5HdhrL.js";import"./user-CAZ9w-Ov.js";import"./theme-toggle-DmE4dG8g.js";import"./users-BsWlUMcl.js";import"./shield-B62tIG1s.js";import"./database-Bma1fOMh.js";import"./chevron-right-Wgfm7FsJ.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],H=A("pause",q);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],W=A("play",U),Z=()=>crypto.randomUUID(),y="nay_scripts_manager",m={getAll:async()=>{const s=localStorage.getItem(y);return s?JSON.parse(s):[]},getById:async s=>(await m.getAll()).find(l=>l.id===s),create:async s=>{const o=await m.getAll(),l={...s,id:Z(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return o.push(l),localStorage.setItem(y,JSON.stringify(o)),l},update:async(s,o)=>{const l=await m.getAll(),i=l.findIndex(d=>d.id===s);if(i===-1)throw new Error("Script not found");const t={...l[i],...o,updatedAt:new Date().toISOString()};return l[i]=t,localStorage.setItem(y,JSON.stringify(l)),t},delete:async s=>{const l=(await m.getAll()).filter(i=>i.id!==s);localStorage.setItem(y,JSON.stringify(l))},toggleStatus:async s=>{const o=await m.getAll(),l=o.findIndex(i=>i.id===s);if(l===-1)throw new Error("Script not found");return o[l].isActive=!o[l].isActive,o[l].updatedAt=new Date().toISOString(),localStorage.setItem(y,JSON.stringify(o)),o[l]}};function B({initialData:s,onSubmit:o,onCancel:l,isLoading:i}){const[t,d]=x.useState({name:"",type:"analytics",location:"head",loadingStrategy:"async",pages:"all",environment:"production",content:"",isActive:!0,deviceAttributes:["desktop","tablet","mobile"]}),[p,f]=x.useState([]);x.useEffect(()=>{s&&(d(s),v(s.content||""))},[s]);const v=r=>{const n=[];r.includes("document.write")&&n.push("تحذير: استخدام document.write قد يبطئ الموقع بشكل كبير."),r.includes("eval(")&&n.push("تحذير أمني: استخدام eval() غير آمن وقد يعرض الموقع للاختراق."),r.includes("<script")&&r.includes("<\/script>")&&n.push("ملاحظة: لا حاجة لكتابة وسوم <script>، النظام سيضيفها تلقائياً."),f(n)},g=r=>{const n=r.target.value;d({...t,content:n}),v(n)},b=r=>{r.preventDefault(),o(t)},h=r=>{const n=t.deviceAttributes||[];n.includes(r)?d({...t,deviceAttributes:n.filter(u=>u!==r)}):d({...t,deviceAttributes:[...n,r]})},c=(()=>{var r,n,u;return(r=t.content)!=null&&r.includes("document.write")||(n=t.content)!=null&&n.includes("eval")||t.location==="head"&&!((u=t.loadingStrategy)!=null&&u.match(/async|defer/))?"high":t.loadingStrategy==="lazy"||t.loadingStrategy==="interaction"?"low":"medium"})();return e.jsxs("form",{onSubmit:b,className:"flex flex-col h-full",children:[e.jsxs("div",{className:`flex items-center gap-4 p-4 rounded-2xl border mb-6 ${c==="high"?"bg-red-50 border-red-100 dark:bg-red-900/10 dark:border-red-900/30":c==="medium"?"bg-amber-50 border-amber-100 dark:bg-amber-900/10 dark:border-amber-900/30":"bg-emerald-50 border-emerald-100 dark:bg-emerald-900/10 dark:border-emerald-900/30"}`,children:[e.jsx("div",{className:`p-2 rounded-full ${c==="high"?"bg-red-100 text-red-600":c==="medium"?"bg-amber-100 text-amber-600":"bg-emerald-100 text-emerald-600"}`,children:e.jsx(L,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-sm text-gray-900 dark:text-white",children:c==="high"?"تأثير عالي على الأداء":c==="medium"?"تأثير متوسط":"آمن / تأثير منخفض"}),e.jsx("p",{className:"text-xs opacity-70",children:c==="high"?"قد يسبب بطء في التحميل.":c==="medium"?"تأثير مقبول.":"لن يؤثر على السرعة."})]}),e.jsxs("button",{type:"button",className:"flex items-center gap-2 px-3 py-2 rounded-xl bg-white dark:bg-white/5 border border-gray-200 dark:border-gray-700 text-xs font-bold hover:bg-gray-50 dark:hover:bg-white/10 transition-colors",children:[e.jsx(_,{className:"w-3 h-3"}),"Archive"]})]}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-12 gap-8 min-h-0 overflow-visible",children:[e.jsxs("div",{className:"lg:col-span-5 space-y-6 overflow-y-auto custom-scrollbar pr-1",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(P,{label:"اسم السكربت",value:t.name,onChange:r=>d({...t,name:r.target.value}),icon:k,required:!0,placeholder:"مثال: Google Analytics 4"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-400 uppercase tracking-wider",children:"النوع"}),e.jsxs("select",{className:"w-full bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-white/10 rounded-xl px-3 py-3 font-bold text-sm outline-none focus:border-primary",value:t.type,onChange:r=>d({...t,type:r.target.value}),children:[e.jsx("option",{value:"analytics",children:"Analytics"}),e.jsx("option",{value:"ads",children:"Ads"}),e.jsx("option",{value:"pixels",children:"Pixels"}),e.jsx("option",{value:"chat",children:"Chat"}),e.jsx("option",{value:"custom",children:"Custom"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-400 uppercase tracking-wider",children:"البيئة"}),e.jsxs("select",{className:"w-full bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-white/10 rounded-xl px-3 py-3 font-bold text-sm outline-none focus:border-primary",value:t.environment,onChange:r=>d({...t,environment:r.target.value}),children:[e.jsx("option",{value:"production",children:"Production"}),e.jsx("option",{value:"staging",children:"Staging"}),e.jsx("option",{value:"development",children:"Dev"})]})]})]})]}),e.jsxs("div",{className:"p-4 rounded-2xl border border-gray-100 dark:border-gray-800 bg-gray-50/50 dark:bg-gray-900/20 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(z,{className:"w-4 h-4 text-primary"}),e.jsx("h5",{className:"font-bold text-sm",children:"التكوين التقني"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-400",children:"المكان"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("label",{className:`flex items-center gap-2 px-3 py-2 rounded-lg border cursor-pointer transition-all ${t.location==="head"?"bg-white border-primary shadow-sm":"border-transparent hover:bg-white/50"}`,children:[e.jsx("input",{type:"radio",name:"loc",checked:t.location==="head",onChange:()=>d({...t,location:"head"}),className:"text-primary"}),e.jsx("span",{className:"text-xs font-bold",children:"Head"})]}),e.jsxs("label",{className:`flex items-center gap-2 px-3 py-2 rounded-lg border cursor-pointer transition-all ${t.location==="footer"?"bg-white border-primary shadow-sm":"border-transparent hover:bg-white/50"}`,children:[e.jsx("input",{type:"radio",name:"loc",checked:t.location==="footer",onChange:()=>d({...t,location:"footer"}),className:"text-primary"}),e.jsx("span",{className:"text-xs font-bold",children:"Footer"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-400",children:"التحميل"}),e.jsxs("select",{className:"w-full bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg px-2 py-2 text-xs font-medium",value:t.loadingStrategy,onChange:r=>d({...t,loadingStrategy:r.target.value}),children:[e.jsx("option",{value:"async",children:"Async"}),e.jsx("option",{value:"defer",children:"Defer"}),e.jsx("option",{value:"lazy",children:"Lazy Load"}),e.jsx("option",{value:"interaction",children:"On Interaction"})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-[10px] font-black text-gray-400 uppercase tracking-wider flex items-center gap-2",children:[e.jsx(J,{className:"w-3 h-3"}),"الاستهداف"]}),e.jsx("div",{className:"flex bg-gray-100 dark:bg-gray-800 p-1 rounded-xl",children:["desktop","tablet","mobile"].map(r=>{var n;return e.jsx("button",{type:"button",onClick:()=>h(r),className:`flex-1 py-1.5 rounded-lg text-xs font-bold transition-all ${(n=t.deviceAttributes)!=null&&n.includes(r)?"bg-white text-gray-900 shadow-sm":"text-gray-400 hover:text-gray-600"}`,children:r==="desktop"?"PC":r==="tablet"?"Tablet":"Mobile"},r)})}),e.jsxs("select",{className:"w-full bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-white/10 rounded-xl px-3 py-3 font-bold text-sm outline-none focus:border-primary",value:t.pages,onChange:r=>d({...t,pages:r.target.value}),children:[e.jsx("option",{value:"all",children:"جميع الصفحات"}),e.jsx("option",{value:"public",children:"الصفحات العامة"}),e.jsx("option",{value:"auth",children:"تسجيل الدخول"}),e.jsx("option",{value:"custom",children:"تخصيص..."})]})]})]}),e.jsxs("div",{className:"lg:col-span-7 flex flex-col h-full min-h-[400px]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{className:"text-[10px] font-black text-gray-400 uppercase tracking-wider flex items-center gap-2",children:[e.jsx(k,{className:"w-3 h-3"}),"الكود (Javascript / HTML)"]}),p.length>0&&e.jsxs("span",{className:"text-[10px] font-bold text-amber-500 bg-amber-50 px-2 py-0.5 rounded-full flex items-center gap-1",children:[e.jsx(j,{className:"w-3 h-3"}),p.length," تنبيهات"]})]}),e.jsxs("div",{className:"relative flex-1 group rounded-2xl overflow-hidden border-2 border-gray-100 dark:border-gray-800 focus-within:border-primary transition-colors bg-gray-900",children:[e.jsxs("div",{className:"absolute top-0 right-0 left-0 h-8 bg-gray-800 flex items-center px-4 gap-2 border-b border-gray-700",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500/50"}),e.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-500/50"}),e.jsx("div",{className:"w-3 h-3 rounded-full bg-emerald-500/50"}),e.jsx("span",{className:"mr-auto text-[10px] font-mono text-gray-400",children:"script-editor"})]}),e.jsx("textarea",{value:t.content,onChange:g,className:"w-full h-full bg-transparent text-gray-100 font-mono text-xs p-4 pt-10 outline-none resize-none leading-relaxed selection:bg-primary/30 custom-scrollbar",placeholder:"// اكتب الكود هنا...",dir:"ltr",spellCheck:!1})]}),p.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:p.map((r,n)=>e.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold text-amber-600 bg-amber-50 p-2 rounded-lg",children:[e.jsx(j,{className:"w-3 h-3 shrink-0"}),r]},n))})]})]}),e.jsxs("div",{className:"flex gap-4 pt-6 mt-4 border-t border-gray-100 dark:border-white/5",children:[e.jsxs("button",{type:"submit",disabled:i,className:"flex-1 bg-gray-900 dark:bg-white text-white dark:text-gray-900 rounded-xl py-4 font-black hover:opacity-90 transition-all flex items-center justify-center gap-2",children:[i?e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(F,{className:"w-5 h-5"}),"حفظ ومتابعة"]}),e.jsx("button",{type:"button",onClick:l,className:"px-8 bg-gray-100 dark:bg-white/5 text-gray-500 rounded-xl py-4 font-bold hover:bg-gray-200 transition-colors",children:"إلغاء"})]})]})}function he(){const{showSuccess:s,showError:o}=O(),{registerAddAction:l,unregisterAddAction:i}=D(),[t,d]=x.useState([]),[p,f]=x.useState(!0),[v,g]=x.useState(!1),[b,h]=x.useState(null),[N,c]=x.useState(!1);x.useEffect(()=>{r()},[]),x.useEffect(()=>(l(()=>{h(null),g(!0)},"إضافة سكربت",S),()=>i()),[l,i]);const r=async()=>{f(!0);try{const a=await m.getAll();d(a)}catch{o("فشل تحميل السكربتات")}finally{f(!1)}},n=async a=>{c(!0);try{b?(await m.update(b.id,a),s("تم تحديث السكربت بنجاح")):(await m.create(a),s("تم إضافة السكربت بنجاح")),g(!1),r()}catch{o("حدث خطأ أثناء الحفظ")}finally{c(!1)}},u=async a=>{if(window.confirm("هل أنت متأكد من حذف هذا السكربت؟"))try{await m.delete(a),s("تم الحذف بنجاح"),r()}catch{o("فشل الحذف")}},C=async a=>{try{await m.toggleStatus(a),s("تم تغيير الحالة بنجاح"),r()}catch{o("فشل تغيير الحالة")}},I=x.useMemo(()=>[{header:"السكربت",accessor:a=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-2xl ${a.isActive?"bg-blue-50 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400":"bg-gray-100 text-gray-500"}`,children:e.jsx(R,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[a.name,a.isActive?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-600 text-[10px] font-black border border-emerald-100",children:"نشط"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-gray-100 text-gray-500 text-[10px] font-black border border-gray-200",children:"معطل"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 flex items-center gap-2",children:[e.jsx("span",{className:"bg-gray-50 px-2 py-0.5 rounded border border-gray-100 dark:border-white/5 uppercase",children:a.type}),e.jsx("span",{className:"text-gray-300",children:"•"}),e.jsx("span",{children:a.location})]})]})]}),sortable:!0,sortKey:"name"},{header:"بيئة العمل",accessor:a=>e.jsx("span",{className:`text-xs font-bold px-3 py-1 rounded-full ${a.environment==="production"?"bg-purple-50 text-purple-600 border border-purple-100":a.environment==="development"?"bg-amber-50 text-amber-600 border border-amber-100":"bg-cyan-50 text-cyan-600 border border-cyan-100"}`,children:a.environment}),className:"w-[120px]"},{header:"آخر تعديل",accessor:a=>e.jsx("div",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",dir:"ltr",children:G(a.updatedAt)}),sortable:!0,sortKey:"updatedAt",className:"w-[150px]"},{header:"الإجراءات",accessor:a=>e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx("button",{onClick:()=>C(a.id),className:`p-2 rounded-xl transition-colors ${a.isActive?"bg-amber-50 text-amber-600 hover:bg-amber-100 dark:bg-amber-900/20":"bg-emerald-50 text-emerald-600 hover:bg-emerald-100 dark:bg-emerald-900/20"}`,title:a.isActive?"تعطيل":"تفعيل",children:a.isActive?e.jsx(H,{className:"w-4 h-4"}):e.jsx(W,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{h(a),g(!0)},className:"p-2 rounded-xl bg-blue-50 text-blue-600 hover:bg-blue-100 dark:bg-blue-900/20 dark:hover:bg-blue-900/40 transition-colors",title:"تعديل",children:e.jsx(K,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>u(a.id),className:"p-2 rounded-xl bg-red-50 text-red-600 hover:bg-red-100 dark:bg-red-900/20 dark:hover:bg-red-900/40 transition-colors",title:"حذف",children:e.jsx(T,{className:"w-4 h-4"})})]}),className:"w-[180px]"}],[]);return e.jsxs(M,{title:"إدارة النصوص البرمجية (Scripts)",hideLeftSidebar:!0,actions:e.jsxs("button",{onClick:()=>{h(null),g(!0)},className:"flex items-center gap-2 bg-gray-900 dark:bg-white text-white dark:text-gray-900 px-6 py-3 rounded-2xl font-bold hover:opacity-90 transition-all shadow-lg active:scale-95",children:[e.jsx(S,{className:"w-5 h-5"}),e.jsx("span",{children:"إضافة سكربت جديد"})]}),children:[e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/10 border border-amber-100 dark:border-amber-900/20 p-4 rounded-2xl mb-6 flex items-start gap-4",children:[e.jsx("div",{className:"p-2 bg-amber-100 dark:bg-amber-900/30 rounded-xl",children:e.jsx(j,{className:"w-6 h-6 text-amber-600 dark:text-amber-500"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-gray-900 dark:text-white mb-1",children:"منطقة حساسة"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"هذه الأكواد تعمل بصلاحيات كاملة على الموقع. أي خطأ برمجي هنا قد يؤدي إلى توقف الموقع أو ثغرات أمنية. يرجى المراجعة الدقيقة قبل التفعيل."})]})]}),e.jsx("div",{className:"flex-1 bg-white dark:bg-dark-900 rounded-[2rem] border border-gray-100 dark:border-dark-800 shadow-sm overflow-hidden flex flex-col",children:e.jsx($,{columns:I,data:t,isLoading:p,emptyMessage:"لا توجد سكربتات مضافة حالياً"})})]}),e.jsx(E,{isOpen:v,onClose:()=>g(!1),title:b?"تعديل السكربت":"إضافة سكربت جديد",size:"xl",children:e.jsx(B,{initialData:b,onSubmit:n,onCancel:()=>g(!1),isLoading:N})})]})}export{he as default};
